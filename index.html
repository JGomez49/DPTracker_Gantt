

<!-- .. -->



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSV + Gantt Viewer</title>

  <!-- Bootswatch Darkly Theme -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/darkly/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: "Segoe UI", Arial, sans-serif;
      _padding: 20px;
    }
    h2, h3 {
      color: #00d1b2;
      margin-top: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px 12px;
      text-align: left;
    }
    th {
      background-color: #222;
      color: #00d1b2;
    }
    tr:nth-child(even) {
      background-color: #1a1a1a;
    }
    tr:hover {
      background-color: #2a2a2a;
    }
    canvas {
      width: 100% !important;
      margin-bottom: 40px;
      background-color: #1e1e1e;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .accordion-button {
      font-weight: bold;
      font-size: 1.2rem;
    }
  </style>
</head>

<body>
<main class="container my-4">
  <h2>ðŸ“‚ Upload DP Tracker CSV File</h2>
  <input class="form-control w-50 mb-4 bg-dark" style="color: #e0e0e0;" type="file" id="csvFile" accept=".csv">

  <div class="accordion mb-4" id="accordionExample">
    <div class="accordion-item bg-dark border-0">
      <h2 class="accordion-header" id="headingOne">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" 
                data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          ðŸ“‹ Table
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne">
        <div class="accordion-body">
          <table id="csvTable" class="table table-dark table-striped table-bordered"></table>
        </div>
      </div>
    </div>
  </div>

  <div id="chartContainer"></div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.1.0/dist/chartjs-plugin-annotation.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

  <script>
    let chartInstances = [];

    function excelSerialToDate(serial) {
      const utcMillis = (serial - 25569) * 86400 * 1000;
      const d = new Date(Math.round(utcMillis));
      return new Date(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate());
    }
    function parseExcelDate(value) {
      if (value instanceof Date && !isNaN(value)) return value;
      if (typeof value === "number") return excelSerialToDate(value);
      const parsed = Date.parse(value);
      if (!isNaN(parsed)) return new Date(parsed);
      return null;
    }

    document.getElementById('csvFile').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      Papa.parse(file, {
        complete: function(results) {
          let data = results.data;
          data = data.filter(row => row.some(cell => cell.trim() !== ""));

          const deleteCols = [1,2,3,4,5,6,7,8,9,11,12,13,14,15,
                              18,19,20,21,22,23,26,27,28];

          // keep columns 0, 10, 16, 17, 24, 25 (Rig, DP, VP, Start, Site, Well)
          
          data = data.map(row => row.filter((_, idx) => !deleteCols.includes(idx)));

          data = data.map((row, rIdx) => {
            if (rIdx === 0) {
              row.splice(3, 0, "Duration");
            } else {
              let found = "";
              for (let i = 3; i < row.length; i++) {
                if (!isNaN(row[i]) && row[i].trim() !== "") {
                  found = parseFloat(row[i]);
                  break;
                }
              }
              row.splice(3, 0, found || 0);
            }
            return row;
          });

          data = data.map((row, rIdx) => {
            if (rIdx === 0) return row;
            const rig = row[0] ?? "";
            const vp = row[1] ?? "";
            const start = row[2] ?? "";
            const duration = row[3] ?? 0;
            const site = row[4] ?? "";
            const dp = row[5] ?? "";
            const well = row[6] ?? "";
            return [rig, start, site, duration, vp, dp, well];
          });

          data = data.filter((_, idx) => idx === 0 || (idx - 3) % 3 === 0);

          let header = ["Rig", "VP", "Start", "Duration", "DP", "Site", "Well"];
          let finalData = [header, ...data.slice(1)];

          renderTable(finalData);
          renderGantts(finalData);
        }
      });
    });

    function renderTable(data) {
      const table = document.getElementById('csvTable');
      table.innerHTML = "";
      data.forEach((row, rowIndex) => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement(rowIndex === 0 ? 'th' : 'td');
          td.textContent = cell;
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });
    }


    /**
     * Renders Gantt charts based on the provided data.
     * Data format: [Rig, VP, Start, Duration, DP, Site]
     */
    function renderGantts(data) {
      chartInstances.forEach(c => c.destroy());
      chartInstances = [];
      const container = document.getElementById("chartContainer");
      container.innerHTML = "";

      const vpMap = {};
      for (let i = 1; i < data.length; i++) {
        const rig = data[i][0];
        const start = parseExcelDate(data[i][2]);
        const site = data[i][5];
        const duration = Number(data[i][3]);
        const vp = data[i][1];
        const dp = data[i][4];
        const well = data[i][6];
        if (!start) continue;

        if (!vpMap[vp]) vpMap[vp] = {};
        if (!vpMap[vp][rig]) vpMap[vp][rig] = [];
        vpMap[vp][rig].push({ site, start, duration, dp, well });
      }

      const today = new Date();
      const twoMonthsLater = new Date(today.getFullYear(), today.getMonth() + 2, today.getDate());
      const threeMonthsLater = new Date(today.getFullYear(), today.getMonth() + 3, today.getDate());
      const sixMonthsLater = new Date(today.getFullYear(), today.getMonth() + 6, today.getDate());

      Object.keys(vpMap).forEach(vp => {
        const datasets = [];
        const colors = [];
        const rigs = Object.keys(vpMap[vp]);

        rigs.forEach(rig => {
          vpMap[vp][rig].forEach(siteObj => {
            const end = new Date(siteObj.start.getTime() + siteObj.duration * 86400000);
            const dpValue = siteObj.dp ? siteObj.dp.toString().trim() : "";
            const isEmptyDP = !dpValue || dpValue === "***";

            datasets.push({ 
              y: rig, 
              x: [siteObj.start, end], 
              site: siteObj.site.substring(0,5),
              details: {
                Rig: rig,
                VP: vp,
                Start: siteObj.start.toLocaleDateString(),
                Duration: siteObj.duration,
                DP: dpValue,
                Site: siteObj.site,
                Well: siteObj.well
              }
            });

            // push matching color for this bar
            colors.push(isEmptyDP ? "#ff4c4c" : "#0084c7");
          });
        });

        const minDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7);
        const maxDate = sixMonthsLater;

        const title = document.createElement("h3");
        title.textContent = `ðŸ“Š VP: ${vp}`;
        container.appendChild(title);

        const canvas = document.createElement("canvas");
        canvas.height = Math.max(200, rigs.length * 40);
        container.appendChild(canvas);

        const ctx = canvas.getContext("2d");
        const chart = new Chart(ctx, {
          type: "bar",
          data: {
            datasets: [{
              label: "Schedule",
              data: datasets,
              backgroundColor: colors,   // <-- per-bar colors
              borderRadius: 6,
              borderSkipped: false,
              borderColor: "#000000",
              borderWidth: 1,
              parsing: { xAxisKey: "x", yAxisKey: "y" }
            }]
          },
          options: {
            indexAxis: "y",
            responsive: false,
            maintainAspectRatio: false,
            scales: {
              x: {
                type: "time",
                time: { unit: "day", stepSize: 1, tooltipFormat: "dd-MMM-yyyy", displayFormats: { day: "dd-MMM" } },
                min: minDate,
                max: maxDate,
                ticks: { color: "#ccc" },
                grid: { color: "#333" }
              },
              y: {
                type: "category",
                labels: rigs,
                ticks: { color: "#ccc", font: { weight: "bold" } },
                grid: { color: "#333" }
              }
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (ctx) => {
                    const d = ctx.raw.details;
                    return [
                      `Rig: ${d.Rig}`,
                      `VP: ${d.VP}`,
                      `Start: ${d.Start}`,
                      `Duration: ${d.Duration} days`,
                      `DP: ${d.DP}`,
                      `Site: ${d.Site}`,
                      `Well: ${d.Well}`
                    ];
                  }
                }
              },
              datalabels: {
                anchor: "center",
                align: "center",
                color: "#000",
                backgroundColor: "rgba(255,255,255,0)",
                borderRadius: 4,
                padding: 2,
                font: { weight: "bold" },
                formatter: (value) => value.site
              },
              annotation: {
                annotations: {
                  futureBox: {
                    type: "box",
                    xMin: twoMonthsLater,
                    xMax: threeMonthsLater,
                    backgroundColor: "rgba(255,0,0,0.15)",
                    borderWidth: 0
                  },
                  todayLine: {
                    type: "line",
                    xMin: today, xMax: today,
                    borderColor: "red", borderWidth: 2,
                    label: { enabled: true, content: "Today", position: "start", color: "red" }
                  }
                }
              },
              zoom: {
                zoom: { wheel: { enabled: true }, pinch: { enabled: true }, mode: "x" },
                pan: { enabled: true, mode: "x" },
                limits: { x: { min: minDate, max: maxDate } }
              }
            },
            barThickness: 18,
            animation: false,
            hover: { mode: null }
          },
          plugins: [ChartDataLabels]
        });
        chartInstances.push(chart);
      });
    }



  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</main>
</body>
</html>







<!-- . -->